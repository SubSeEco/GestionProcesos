@model App.Web.Controllers.WorkflowController.DTOFilter
@{
    ViewBag.Title = "Bandeja de tareas";
    ViewBag.SubTitle = "Listado de tareas pendientes";
}

<meta http-equiv="refresh" content="120">
<style>
    .tabs .tab a {
        color: rgba(38, 166, 154, 0.7)
    }

        .tabs .tab a:hover {
            color: #26a69a;
        }

        .tabs .tab a:focus.active {
            color: #26a69a;
            background-color: rgba(38, 166, 154, 0.2);
        }

    .tabs .indicator {
        background-color: #26a69a;
    }
</style>

<div class="grey lighten-3">
    <div class="section container ">
        <h3 class="header">@ViewBag.Title</h3>
        <h5 class="header light">@ViewBag.SubTitle</h5>
        <br />
    </div>
</div>
<p></p>
<div class="container">
    @Html.Partial("_Message")
    <div class="row">
        <div class="col s12">
            <ul class="tabs">
                <li class="tab col s3">
                    <a class="active" href="#test1">Tareas personales (@Model.TareasPersonales.Count())</a>
                </li>
                <li class="tab col s3">
                    <a href="#test2">Tareas grupales (@Model.TareasGrupales.Count())</a>
                </li>
            </ul>
        </div>
        <div id="test1" class="col s12">
            @if (!Model.TareasPersonales.Any())
            {
                <p>No existen tareas pendientes</p>
            }
            else
            {
                <ul class="collection">
                    @foreach (var item in Model.TareasPersonales.OrderByDescending(q => q.WorkflowId))
                    {
                        <li class="collection-item avatar section">

                            <p class="right truncate grey-text ultra-small">@item.FechaCreacion</p>

                            @if (item.Proceso.FechaVencimiento.HasValue && DateTime.Now.Date > item.Proceso.FechaVencimiento.Value.Date)
                            {
                                <i class="material-icons circle red large"></i>
                            }
                            @if (item.Proceso.FechaVencimiento.HasValue && DateTime.Now.Date == item.Proceso.FechaVencimiento.Value.Date)
                            {
                                <i class="material-icons circle amber accent-4"></i>
                            }
                            @if (item.Proceso.FechaVencimiento == null || (item.Proceso.FechaVencimiento.HasValue && DateTime.Now.Date < item.Proceso.FechaVencimiento.Value.Date))
                            {
                                <i class="material-icons circle green"></i>
                            }

                            @Html.ActionLink("Tarea " + item.WorkflowId + ": " + item.DefinicionWorkflow.Nombre, "Execute", new { id = item.WorkflowId })

                        <p class="truncate ultra-small">
                            Proceso @Html.DisplayFor(modelItem => item.Proceso.ProcesoId): @Html.DisplayFor(modelItem => item.Proceso.DefinicionProceso.Nombre), iniciado por

                            @if (!string.IsNullOrWhiteSpace(item.Proceso.NombreFuncionario))
                            {
                                @Html.DisplayFor(modelItem => item.Proceso.NombreFuncionario)
                            }
                            else
                            {
                                @Html.DisplayFor(modelItem => item.Proceso.Email)
                            }

                        </p>
                        <p class="truncate ultra-small grey-text">
                            Asignada a:

                            @if (!string.IsNullOrWhiteSpace(item.NombreFuncionario))
                            {
                                @Html.DisplayFor(modelItem => item.NombreFuncionario)<text>, </text>
                            }
                            else
                            {
                                @Html.DisplayFor(modelItem => item.Email)<text>, </text>
                            }
                            @if (!string.IsNullOrWhiteSpace(item.Pl_UndDes))
                            {
                                @Html.DisplayFor(modelItem => item.Pl_UndDes)
                            }
                            @if (item.Grupo != null)
                            {
                                @Html.DisplayFor(modelItem => item.Grupo.Nombre)
                            }
                        </p>

                            @if (!string.IsNullOrWhiteSpace(@item.Mensaje))
                            {
                                <div class="section">
                                    <p class="truncate ultra-small title red-text"> Comentario: @item.Mensaje</p>
                                </div>
                            }

                        </li>
                    }
                </ul>
            }
        </div>
        <div id="test2" class="col s12">
            @if (!Model.TareasGrupales.Any())
            {
                <p>No existen tareas pendientes</p>
            }
            else
            {
                <ul class="collection">
                    @foreach (var item in Model.TareasGrupales.OrderByDescending(q => q.WorkflowId))
                    {
                    <li class="collection-item avatar section">

                        <p class="right truncate grey-text ultra-small">@item.FechaCreacion</p>

                        @if (item.Proceso.FechaVencimiento.HasValue && DateTime.Now.Date > item.Proceso.FechaVencimiento.Value.Date)
                        {
                            <i class="material-icons circle red large"></i>
                        }
                        @if (item.Proceso.FechaVencimiento.HasValue && DateTime.Now.Date == item.Proceso.FechaVencimiento.Value.Date)
                        {
                            <i class="material-icons circle amber accent-4"></i>
                        }
                        @if (item.Proceso.FechaVencimiento == null || (item.Proceso.FechaVencimiento.HasValue && DateTime.Now.Date < item.Proceso.FechaVencimiento.Value.Date))
                        {
                            <i class="material-icons circle green"></i>
                        }

                        @Html.ActionLink("Tarea " + item.WorkflowId + ": " + item.DefinicionWorkflow.Nombre, "Execute", new { id = item.WorkflowId })

                        <p class="truncate ultra-small">
                            Proceso @Html.DisplayFor(modelItem => item.Proceso.ProcesoId): @Html.DisplayFor(modelItem => item.Proceso.DefinicionProceso.Nombre), iniciado por

                            @if (!string.IsNullOrWhiteSpace(item.Proceso.NombreFuncionario))
                            {
                                @Html.DisplayFor(modelItem => item.Proceso.NombreFuncionario)
                            }
                            else
                            {
                                @Html.DisplayFor(modelItem => item.Proceso.Email)
                            }

                        </p>
                        <p class="truncate ultra-small">
                            Asignada a:

                            @if (!string.IsNullOrWhiteSpace(item.NombreFuncionario))
                            {
                                @Html.DisplayFor(modelItem => item.NombreFuncionario)<text> </text>
                            }
                            else
                            {
                                @Html.DisplayFor(modelItem => item.Email)<text> </text>
                            }
                            @if (!string.IsNullOrWhiteSpace(item.Pl_UndDes))
                            {
                                @Html.DisplayFor(modelItem => item.Pl_UndDes)
                            }
                            @if (item.Grupo != null)
                            {
                                @Html.DisplayFor(modelItem => item.Grupo.Nombre)
                            }
                        </p>

                        @if (!string.IsNullOrWhiteSpace(@item.Mensaje))
                        {
                            <div class="section">
                                <p class="truncate ultra-small title red-text"> Comentario: @item.Mensaje</p>
                            </div>
                        }

                    </li>
                    }
                </ul>
            }
        </div>
    </div>
</div>
<div class="fixed-action-btn">
    <a href='@Url.Action("Create", "Proceso")' class="btn-floating btn-large blue tooltipped" data-position="left" data-delay="500" data-tooltip="Agregar nuevo elemento"><i class="large material-icons">add</i></a>
</div>
<script>
    $(document).ready(function () {
        $('.tabs').tabs();
    });
</script>
