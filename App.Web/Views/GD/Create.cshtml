@model App.Model.GestionDocumental.GD

@Html.Action("Header", "Workflow", new { Model.WorkflowId })
    <div class="container">

        @Html.Partial("_Message")

        <div class="row">
            <div class="col s12 m6 l6">
                @using (Html.BeginForm("Edit", null, FormMethod.Post, new { enctype = "multipart/form-data" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.HiddenFor(q => Model.WorkflowId)
                    @Html.HiddenFor(q => Model.ProcesoId)

                    <div class="card">
                        <div class="card-content">
                            <span class="card-title">Información del ingreso</span>
                            <div class="row">
                                <div class="input-field col s12 m12 l12">
                                    @Html.TextAreaFor(m => Model.Materia, new { @class = "materialize-textarea" })
                                    @Html.LabelFor(m => Model.Materia)
                                    @Html.ValidationMessageFor(m => Model.Materia, "", new { @class = "red-text" })
                                </div>
                                <div class="input-field col s12 m12 l12">
                                    @Html.TextAreaFor(m => Model.Referencia, new { @class = "materialize-textarea" })
                                    @Html.LabelFor(m => Model.Referencia)
                                    @Html.ValidationMessageFor(m => Model.Referencia, "", new { @class = "red-text" })
                                </div>
                                <div class="input-field col s12 m12 l12">
                                    @Html.TextAreaFor(m => Model.Observacion, new { @class = "materialize-textarea" })
                                    @Html.LabelFor(m => Model.Observacion)
                                    @Html.ValidationMessageFor(m => Model.Observacion, "", new { @class = "red-text" })
                                </div>
                                <div class="input-field col s12 m12 l12">
                                    <div class="switch">
                                        <label>
                                            @if (Model.RequiereFirmaElectronica)
                                            {
                                                <input type="checkbox" id="RequiereFirmaElectronica" onchange="CheckFirma();" checked="checked">
                                            }
                                            else
                                            {
                                                <input type="checkbox" id="RequiereFirmaElectronica" onchange="CheckFirma();">
                                            }
                                            <span class="lever"></span>Requiere firma electrónica ?
                                        </label>
                                    </div>
                                </div>
                                <div class="input-field col s12 m12 l12" id="divRequiereFirmaUnidad">
                                    @Html.DropDownListFor(m => m.Pl_UndCod, null, "Seleccione...")
                                    @Html.LabelFor(m => Model.Pl_UndCod)
                                    @Html.ValidationMessageFor(m => Model.Pl_UndCod, "", new { @class = "red-text" })
                                </div>
                                <div class="input-field col s12 m12 l12" id="divRequiereFirmaUsuario">
                                    @Html.DropDownListFor(model => model.UsuarioDestino, null, "Seleccione...")
                                    @Html.LabelFor(m => Model.UsuarioDestino)
                                    @Html.ValidationMessageFor(m => Model.UsuarioDestino, "", new { @class = "red-text" })
                                </div>
                            </div>
                            <button class="waves-effect waves-light btn blue" type="submit">Guardar</button>
                        </div>
                    </div>
                }
            </div>
            <div class="col s12 m6 l6">
                @Html.Action("Documents", "Workflow", new { Model.WorkflowId })
                @Html.Action("History", "Workflow", new { Model.WorkflowId })
            </div>
        </div>

    </div>

@Html.Action("Footer", "Workflow", new { Model.WorkflowId })

<script type="text/javascript">
    $(document).ready(function () {
        $('.modal').modal();
        $('select').formSelect();
        $('.tooltipped').tooltip();
        //$('input:hidden').each(function (index, element) {
        //    $(element).appendTo($(element).parent());
        //});

        $("input[type='hidden']").each(function (index, element) {
            $(this).appendTo($(element).parent());
        });

        CheckFirma();
    });

    //Al cambiar unidad traer funcionarios
    $("#Pl_UndCod").change(function () {
        var Pl_UndCod = $(this).val();
        $.getJSON("/Workflow/GetUserByUnidad", { Pl_UndCod: Pl_UndCod },
            function (classesData) {
                var select = $("#UsuarioDestino");
                select.empty();
                select.append($('<option/>', {
                    value: "",
                    text: "Seleccione..."
                }));
                $.each(classesData, function (index, itemData) {
                    select.append($('<option/>', {
                        value: itemData.Email,
                        text: itemData.Nombre
                    }));
                });
                $('#UsuarioDestino').formSelect();
            });
    });

    //Chequear si requiere firma electrónica
    function CheckFirma() {
        var checkedValue = $("#RequiereFirmaElectronica").is(":checked");
        if (checkedValue) {
            $('#divRequiereFirmaUnidad').show();
            $('#divRequiereFirmaUsuario').show();
        }
        else {
            $('#divRequiereFirmaUnidad').hide();
            $('#divRequiereFirmaUsuario').hide();
        }

        @Model.RequiereFirmaElectronica = checkedValue;
    }

</script>

